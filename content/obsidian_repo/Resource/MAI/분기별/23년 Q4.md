![[Pasted image 20231221085054.png]]

Jupyter hub
# Solver 고도화
## 현재까지 달성한 내용
- Sampler 체계화
- model load 시나리오 정리 및 test
- filtering 
- README 재작성
- Test 고도화
	- List up
	- input / output format

## TO-BE
- Test 고도화
	- 모듈 단위 test 가능도록 test 세분화

# Post-analysis 고도화
## Code refactoring
- Code refactoring
	- jupyter code -> pyfile  : only 9cells 
	- interative data distribution check
		- 원하는 정보를 선별해서 추가적으로 확인할 수 있도록 Interactive UI로 사용성 증대 
	- legacy library 변경
		- update되지 않는 iplot lib를 plotly로 모두 변경

## To-Be 
- Transparency 관점의 지표값 넣기
	- faithfulness
	- confidence
	- etc

# Research
## XAI
- Counter-factual based paper 
	- W+ space version update
![[Pasted image 20231221092507.png]]

![[twin_cell1.gif]]

- Regression model version
![[Pasted image 20231221092829.png]]

![[p_regresson1.gif]]

![[Dec-21-2023 09-36-11.gif]]

-  TO-BE 
	- https://arxiv.org/abs/2305.17043
	- Explaining Deep Learning for ECG Analysis: Building Blocks for Auditing and Knowledge Discovery
		- 다른 방법은 대부분 서술되어 있지만, 유일하게 counterfactual방법론이 제외되어 있음.
	




# 공유하고 싶은 내용 : tips for solvers
**1. filecheck 피하기**
	1. 대용량 파일을 학습할 때에 file check하는 시간이 많이 걸림
	2. 만약 이미 해당 파일을 활용하여 학습을 진행하고, file check가 진행된 결과가 있다면 (???\_probability.csv) 다음부턴 해당 파일을 사용할 것을 권장.
	3. (train/valid/test)\_probability.csv 파일은 filecheck를 검수하지 않음.
	4. [code](https://git.medicalai.com:50001/team-ai/solver/solver2/-/blob/master/config/table.py?ref_type=heads#L254)

**2. data split stratification 하기**
	1. A,B.C 컬럼의 데이터가 train,valid,test에 균등하게 stratifacation 해서 분배하고 싶은 경우
	2. 예를 들어 mi_sample.csv 데이터에서 라벨 뿐만 아니라 병원(hos)분포도 동일하게 하고 싶은 경우
		1. `train.label.target:["label:mi", "hos"]`
		2. Dataset class에서 `self.label = label[0]`
	3. [code](https://git.medicalai.com:50001/team-ai/solver/solver2/-/blob/master/config/table.py?ref_type=heads#L405)

**3. 학습할 때, batch 안에 원하는 원하는 column의 distribution이 일정하게 담기도록 학습하기. learning imbalance 조절**
	1. sampler target이 될 temp column 만들기
	2. 예를 들어 label과 age가 매 배치마다 고르게 뽑히길 원하는 경우
		1. `label_df['tmp_col'] = [ str(x)+str(y) for x,y in zip(label_df['label'],label_df['age'])]`
		2. `dataset.ECGDataset.sampler.target:'tmp_col'`

**4. generation model 학습 때 multi gpu 사용 시 각 노드마다 다른 random seed 할당하기**
	1. Generation 모델을 multi gpu로 학습할 시에는 각 노드마다 다양한 sample들을 만들어내는 것이 학습에 좋음
	2. 그러나 현재는 각 노드가 동일한 random seed를 가지기 때문에 모든 노드가 동일한 sample을 중복해서 만듬.
	3. 이를 위해서 solver init에서 아래 코드를 추가해주면 해결됨
		1. set random seed for each node.
		2. [code](https://git.medicalai.com:50001/team-ai/solver/solver2/-/blob/master/trial/solvers/SolverStyleGAN.py?ref_type=heads#L178)

```

np.random.seed(session.get_world_rank())

torch.manual_seed(session.get_world_rank())

```


**5. tensor board로 학습 확인 하기**
	1. VScode에서 안되는 경우 
	2. tensorboard --logdir=[model log directory] --port=[server.port] --host=[server.ip]